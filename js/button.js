function match_exists(t){var e="#match"+t+" li i",a="Match "+t;return $(e).text()!=a?1:(alertify.error("No scheduled match!"),0)}function player_exists(t){return"undefined"==typeof t?(alertify.error("You are not logged in!"),$("#login input:first").focus(),0):1}function add_me(t,e,a,i,r){if(match_exists(t)&&player_exists(e)){var n="#match"+t,s=$(n+" li"),o=0,l=0;if(s.each(function(t,a){return 0==$(a).hasClass("unsure")&&0==$(a).hasClass("waiting")&&0!=o++&&$(a).text()==e?void(l=1):void 0}),13==o)return void alertify.error("Match is full!");if(1==l)return void alertify.error("Already in the match!");var c;c=1!=o?"#match"+t+" li:last-child":"#match"+t+" li:first-child";var u=$(c)[0].outerHTML;$(c).remove(),u=u.replace("ui-last-child",""),$(n).append(u),$(n).append('<li class="ui-btn-icon-left ui-last-child" data-icon="'+a+'"><a href="#" class="ui-btn ui-icon-'+a+'"><span class="tooltip" data-tooltip="'+i+'">'+e+"</span></a></li>"),alertify.success("You were added in Match "+t+"!"),r.item=!0;/*var d=$("#match"+t+" li:first i").text(),h={},f=d.split(" ");h.hour=f[0].split(".")[0],h.day=f[1],h.month=f[2].split("/")[1],h.player=e,$.ajax({url:"php/update_suggest.php",type:"POST",contentType:"application/json",data:JSON.stringify(h),dataType:"html",success:function(t){"ok"!=t&&alert(t)},error:function(t,e,a){$.mobile.loading("hide"),200==t.status?(alert("status = 200"),alert(e)):(alert("status = "+t.status),alert(a))}})*/}}function save_match(t,e){if(player_exists(window.player)){var a=$("#match"+t+" li"),i=-1,r={},n=0,s={},o=0,l={};l.slot=t;var c=0;if(a.each(function(e,a){var u=$(a);if(i>=0){var d=$(u).find("data-icon").context;1==$(d).hasClass("unsure")?(r["unsure"+n]={name:$($(d.innerHTML)[0].innerHTML).text(),pos:$(d).attr("data-icon"),ability:$($(d.innerHTML)[0].innerHTML).attr("data-tooltip"),unsure:1,waiting:0},++n):1==$(d).hasClass("waiting")?(s["waiting"+o]={name:$($(d.innerHTML)[0].innerHTML).text(),pos:$(d).attr("data-icon"),ability:$($(d.innerHTML)[0].innerHTML).attr("data-tooltip"),unsure:0,waiting:1},o++):(l["player"+i]={name:$($(d.innerHTML)[0].innerHTML).text(),pos:$(d).attr("data-icon"),ability:$($(d.innerHTML)[0].innerHTML).attr("data-tooltip"),unsure:0,waiting:0},++c),++i}else i=0,l.saves=1==t?window.saves1.item:window.saves2.item,l.title=$(u).find("i").text(),l.creator=1==t?window.creator1:window.creator2}),c>10)return void alertify.error("There are more than 10 sure players!");for(var u=i+1,d=0;o>d;++d)l["player"+u++]={name:s["waiting"+d].name,pos:s["waiting"+d].pos,ability:s["waiting"+d].ability,unsure:0,waiting:1};for(var d=0;n>d;++d)l["player"+u++]={name:r["unsure"+d].name,pos:r["unsure"+d].pos,ability:r["unsure"+d].ability,unsure:1,waiting:0};$.ajax({url:"php/save_match.php",type:"POST",contentType:"application/json",data:JSON.stringify(l),dataType:"html",success:function(a){window.obj_need_save.item=!1,parseInt(a)==a?1==t?window.saves1.item=a:window.saves2.item=a:"not_ok"==a?swal({title:"Damn!",text:"Someone else saved before you, try again! Page will refresh.",type:"error",showConfirmButton:!0},function(){location.reload()}):(alert("Error!"),location.reload()),alertify.success("Match "+t+" saved!"),e.item=!1},error:function(t,e,a){$.mobile.loading("hide"),200==t.status?(alert("status = 200"),alert(e)):(alert("status = "+t.status),alert(a))}})}}function isLetter(t){return 1===t.length&&t.match(/[a-z]/i)}function create_match(t,e,a){var i="#match"+t+" li i",r="Match "+t;return $(i).text()!=r?void alertify.alert("There is a scheduled match already!"):void(player_exists(e)&&(alertify.set({buttonReverse:!0}),alertify.set({buttonFocus:"ok"}),alertify.prompt("MUST use the following format",function(r,n){if(r){var s=/^[0-9]{1,2}[.:][0-9]{1,2} [A-Z][a-z]{5,8} [0-9]{1,2}\/[0-9]{1,2}$/;if(!n.match(s))return void alertify.error("Bad format, match creation failed!");$(i).text(n),1==t?window.creator1=e:window.creator2=e,alertify.success("Created: "+n),a.item=!0}else alertify.error("Cancel pressed")},"19.30 Friday 15/5")))}function delete_me(t,e,a){if(match_exists(t)&&player_exists(e)){var i="#match"+t+" li",r=$("#match"+t+" li"),n=0,s=0;if(r.each(function(t,a){return 0!=t&&-1!=$(a).text().indexOf(e)?void(s=1):void(0==s&&++n)}),0==s)return void alertify.error("You are not in the match!");$(i).eq(n).remove(),alertify.success("You were deleted from Match "+t+"!"),a.item=!0}}function waiting(t,e,a){if(match_exists(t)&&player_exists(e)){var i="#match"+t+" li",r=$("#match"+t+" li"),n=0,s=0;if(r.each(function(t,a){return $(a).text()==e?void(s=1):void(0==s&&++n)}),0==s)return void alertify.error("You are not in the match!");var o=$(i).eq(n);o.hasClass("unsure")?alertify.error("You can not be waiting and unsure at the same time!"):o.hasClass("waiting")?(o.removeClass("waiting"),alertify.success("You were set as sure in Match "+t+"!"),a.item=!0):(o.addClass("waiting"),alertify.success("You were set as waiting in Match "+t+"!"),a.item=!0)}}function unsure(t,e,a){if(match_exists(t)&&player_exists(e)){var i="#match"+t+" li",r=$("#match"+t+" li"),n=0,s=0;if(r.each(function(t,a){return $(a).text()==e?void(s=1):void(0==s&&++n)}),0==s)return void alertify.error("You are not in the match!");var o=$(i).eq(n);o.hasClass("waiting")?alertify.error("You can not be unsure and waiting at the same time!"):o.hasClass("unsure")?(o.removeClass("unsure"),alertify.success("You were set as sure in Match "+t+"!"),a.item=!0):(o.addClass("unsure"),alertify.success("You were set as unsure in Match "+t+"!"),a.item=!0)}}function refresh(){swal({title:"Are you sure?",text:"All changes will be LOST!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, refresh!",cancelButtonText:"No, cancel!",closeOnConfirm:!1,closeOnCancel:!1},function(t){t?(window.obj_need_save.item=!1,location.reload()):swal("Cancelled","Your data are safe :)","error")})}function add_noncage(t,e,a){if(match_exists(t)&&player_exists(e)){var i="#match"+t,r=$(i+" li"),n=0;if(r.each(function(){++n}),13==n)return void alertify.error("Match is full!");var s;s=1!=n?"#match"+t+" li:last-child":"#match"+t+" li:first-child";var o=$(s)[0].outerHTML;$(s).remove(),o=o.replace("ui-last-child",""),$(i).append(o),$(i).append('<li class="ui-btn-icon-left ui-last-child" data-icon="rb"><a href="#" class="ui-btn ui-icon-rb"><span class="tooltip" data-tooltip="whoKnows">noncage'+e+"</span></a></li>"),alertify.success("A noncage player was added in Match "+t+"!"),a.item=!0}}function delete_match(t,e,a){if(match_exists(t)&&player_exists(e)){if(1==t){if(e!=window.creator1&&"Samaras"!=e)return void swal({title:"Forbidden",text:"You are not the match creator!",timer:4e3,type:"error",showConfirmButton:!0})}else if(e!=window.creator2&&"Samaras"!=e)return void swal({title:"Forbidden",text:"You are not the match creator!",timer:4e3,type:"error",showConfirmButton:!0});1==t?window.creator1="void":window.creator2="void";var i="#match"+t+" li:not(:first)",r=$(i);r.remove(),$("#match"+t+" li i").text("Match "+t),alertify.success("Match"+t+" deleted!"),a.item=!0}}
